<!DOCTYPE html>
<html>
<head><meta charset="utf-8" />
<title>simulation</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>








<!-- Custom stylesheet, it must be in the same directory as the html file -->
<link rel="stylesheet" href="custom.css">

<!-- Loading mathjax macro -->
<!-- Load mathjax -->
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    <!-- End of mathjax configuration --></head>

 <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>

<style>  /* defined here in case the main.css below cannot be loaded */
.lev1 {margin-left: 80px}
.lev2 {margin-left: 100px}
.lev3 {margin-left: 120px}
.lev4 {margin-left: 140px}
.lev5 {margin-left: 160px}
.lev6 {margin-left: 180px}
</style>

<link rel="stylesheet" type="text/css" href="../../css/jt.css">
<link rel="stylesheet" type="text/css" href="../../css/toc2.css">

<script src="../../js/toc2.js"></script>
<script src="../../js/docs.js"></script>

<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            preferredFont: "TeX",
            availableFonts: ["STIX","TeX"],
            styles: {
                scale: 110,
                ".MathJax_Display": {
                    "font-size": "110%",
                }
            }
        }
    });
</script>

<script>
$( document ).ready(function(){

            var cfg={'threshold':3,     // depth of toc (number of levels)
             'number_sections': false, 
             'toc_cell': false,          // useless here
             'toc_window_display': true, // display the toc window
             "toc_section_display": "block", // display toc contents in the window
             'sideBar':true,       // sidebar or floating window
             'navigate_menu':false       // navigation menu (only in liveNotebook -- do not change)
            }

            var st={};                  // some variables used in the script
            st.rendering_toc_cell = false;
            st.config_loaded = false;
            st.extension_initialized=false;
            st.nbcontainer_marginleft = $('#notebook-container').css('margin-left')
            st.nbcontainer_marginright = $('#notebook-container').css('margin-right')
            st.nbcontainer_width = $('#notebook-container').css('width')
            st.oldTocHeight = undefined
            st.cell_toc = undefined;
            st.toc_index=0;

            // fire the main function with these parameters


            table_of_contents(cfg,st);

            var file=analysisDict[$("h1:first").attr("id")];
            $("#toc-level0 a").css("color","#126dce");
            $('a[href="#'+$("h1:first").attr("id")+'"]').hide()
            var docs=documentation;
            var pos=documentation.indexOf(file);
        
            for (var a=pos;a>=0;a--){
                  var name=docs[a]
                  $('<li><a href="'+name+'.html">'+name.replace(/_/g," ")+'</a></li>').insertBefore("#toc-level0 li:eq(0)");
            }
            $('a[href="'+file+'.html'+'"]').css("color","#126dce");


            $('<li id="indexHome"><a href="../../documentation.html"><b>Analysis Home<b></a></li>').insertBefore("#toc-level0 li:eq(0)");
            for (var a=pos+1;a<docs.length;a++){
                  var name=docs[a]
                  $(".toc #toc-level0").append('<li><a href="'+name+'.html">'+name.replace(/_/g," ")+'</a></li>');
            }
            $("#toc-header").hide();

    });
</script>
<body>
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Simulation-of-Exome-wide-CNV-data-for-case-control-samples">Simulation of Exome-wide CNV data for case control samples<a class="anchor-link" href="#Simulation-of-Exome-wide-CNV-data-for-case-control-samples">&#182;</a></h1><h2 id="Simulation-outline">Simulation outline<a class="anchor-link" href="#Simulation-outline">&#182;</a></h2><p>For given type of CNV (e.g. duplication) we first simulate all the variants across exome, 
then assign these simulated CNVs to genes. For case samples we expect an enrichment in causal
genes and the enrichment should be quantified by relative risk of a CNV's contribution to disease
when presented in causal gene vs. non causal gene.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters">&#182;</a></h2><p>We define causal CNV as CNV in causal gene, and denote it as CCNV. Likewise we have NCNV for non-causal CNV.</p>
<table>
<thead><tr>
<th style="text-align:center">Parameter</th>
<th style="text-align:center">Description</th>
<th style="text-align:center">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$\lambda$</td>
<td style="text-align:center">Average number of CNV per exome</td>
<td style="text-align:center">100 for dup, 20 for del (<em>FIXME: reference required</em>)</td>
</tr>
<tr>
<td style="text-align:center">$p_L$</td>
<td style="text-align:center">Parameter for Geometric distribution that models length of CNV</td>
<td style="text-align:center">To be fitted from data</td>
</tr>
<tr>
<td style="text-align:center">$\gamma$</td>
<td style="text-align:center">Odds ratio of CCNV</td>
<td style="text-align:center">To draw from distribution Gamma(5, 1)</td>
</tr>
<tr>
<td style="text-align:center">$p_0$</td>
<td style="text-align:center">Pr(case &#124; NCNV)</td>
<td style="text-align:center">To be calculated below</td>
</tr>
<tr>
<td style="text-align:center">$p_1$</td>
<td style="text-align:center">Pr(case &#124; CCNV)</td>
<td style="text-align:center">To be calculated from $p_0$ and $\gamma$</td>
</tr>
<tr>
<td style="text-align:center">$N_0, N_1$</td>
<td style="text-align:center">Case / Ctrl sample size</td>
<td style="text-align:center">Various numbers</td>
</tr>
<tr>
<td style="text-align:center">$q$</td>
<td style="text-align:center">Proportion of causal gene</td>
<td style="text-align:center">(<em>FIXME: reference required</em>)</td>
</tr>
<tr>
<td style="text-align:center">$k$</td>
<td style="text-align:center">The prevalence of disease</td>
<td style="text-align:center">(<em>FIXME: reference required</em>)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Simulation-steps">Simulation steps<a class="anchor-link" href="#Simulation-steps">&#182;</a></h2><p>The steps below simulates exome data for single individual case or control for one type of CNV.</p>
<h3 id="Step-1:-Simulate-number-of-CNV-per-exome">Step 1: Simulate number of CNV per exome<a class="anchor-link" href="#Step-1:-Simulate-number-of-CNV-per-exome">&#182;</a></h3><p>Simply drawn from Pois($\lambda$)</p>
<h3 id="Step-2:-Get-the-length-of-each-of-these-CNV-simulated">Step 2: Get the length of each of these CNV simulated<a class="anchor-link" href="#Step-2:-Get-the-length-of-each-of-these-CNV-simulated">&#182;</a></h3><p>First, separate genome to 10K blocks and find how many CNVs start within each block (for real data), draw histogram and create a table. Define any block containing 2 or more CNVs as a hotspot.</p>
<p>Second, mimic the distribution of the length of CNV: fit a mixture of geometric, a prop is long tail, a prop is short and a prop is normal.</p>
<p>Finally for each CNV, draw the length of it from the distribution obtained, and set the start point according to the histogram of CNV start point among 10K blocks, and set the length according to mixed geometric.</p>
<h3 id="Step-3:-Get-the-probability-of-a-sample-being-case-give-all-CNVs">Step 3: Get the probability of a sample being case give all CNVs<a class="anchor-link" href="#Step-3:-Get-the-probability-of-a-sample-being-case-give-all-CNVs">&#182;</a></h3><p>Suppose $p$ is baseline probability of the disease (prevalence), and $r_0$ is the baseline odds $\frac{p}{1-p}$.</p>
<p>Given simulated CNVs in a sample, the probability for the sample to be case is $p_1$, then the odds ratio for case is $r_1 = r_0 \times R = \frac{p_1}{1-p_1}$, $R$ is the combined relative risks of the all CNVs involved in a sample. Each $R_i$ for causal CNVs is to be sampled from Gamma(1,5), $R = \prod_{i=1}^{\#CNV} R_i$. For noncausal CNV, the $R_i$ is 1. Then $P(case|all CNV) = p_1 = \frac{r_0*R}{1+r_0*R}$, and $P(ctrl|all CNV) = 1-p_1$.</p>
<p>Since $p_1$ is small, about $\frac{1}{p} * n$ trials are to be simulated in order to obtain $n$ cases. However, $n$ controls are easy to obtain.</p>
<h3 id="Step-4:-Check-if-CNVs-overlap-with-causal-gene">Step 4: Check if CNVs overlap with causal gene<a class="anchor-link" href="#Step-4:-Check-if-CNVs-overlap-with-causal-gene">&#182;</a></h3><p>Causal/noncausal gene positions are supposed to be determined by literature. But we can simulate randomly for starters.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Implementation">Implementation<a class="anchor-link" href="#Implementation">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandasql</span> <span class="k">import</span> <span class="n">sqldf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ref_gene</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s2">&quot;data/refGene.txt.gz&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> 
                         <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span> 
                         <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tx_name&quot;</span><span class="p">,</span> <span class="s2">&quot;chrom&quot;</span><span class="p">,</span> <span class="s2">&quot;tx_start&quot;</span><span class="p">,</span> <span class="s2">&quot;tx_end&quot;</span><span class="p">,</span> <span class="s2">&quot;gene_name&quot;</span><span class="p">])</span>
<span class="c1">#gene_df = ref_gene.drop_duplicates(subset=(&quot;chrom&quot;, &quot;tx_start&quot;, &quot;tx_end&quot;, &quot;gene_name&quot;))</span>
<span class="n">gene_df</span> <span class="o">=</span> <span class="n">ref_gene</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;chrom&quot;</span><span class="p">,</span> <span class="s2">&quot;tx_start&quot;</span><span class="p">,</span> <span class="s2">&quot;tx_end&quot;</span><span class="p">))</span>
<span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">select chrom, gene_name, min(tx_start), max(tx_end)</span>
<span class="s1">from gene_df</span>
<span class="s1">group by chrom, gene_name</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="n">gene_table</span> <span class="o">=</span> <span class="n">sqldf</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="c1">#print (gene_table)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Step-1-&amp;-2">Step 1 &amp; 2<a class="anchor-link" href="#Step-1-&amp;-2">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[61]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;data/ISC-r1.CNV.bed&quot;</span>
<span class="n">cnvbed</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;chr&quot;</span><span class="p">):</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;name=&quot;</span><span class="p">)</span>
        <span class="n">cnvbed</span><span class="p">[</span><span class="n">dataset</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">continue</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">cnvbed</span><span class="p">[</span><span class="n">dataset</span><span class="p">]:</span>
        <span class="n">cnvbed</span><span class="p">[</span><span class="n">dataset</span><span class="p">][</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cnvbed</span><span class="p">[</span><span class="n">dataset</span><span class="p">][</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
    
<span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">cnvbed</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">chrom</span> <span class="ow">in</span> <span class="n">cnvbed</span><span class="p">[</span><span class="n">dataset</span><span class="p">]:</span>
        <span class="n">cnvbed</span><span class="p">[</span><span class="n">dataset</span><span class="p">][</span><span class="n">chrom</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

<span class="n">cnvbed_df</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">cnvbed</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">cnvbed_df</span><span class="p">[</span><span class="n">dataset</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;chrom&quot;</span><span class="p">:[],</span> <span class="s2">&quot;cnv_start&quot;</span><span class="p">:[],</span> <span class="s2">&quot;cnv_end&quot;</span><span class="p">:[]}</span>
    <span class="k">for</span> <span class="n">chrom</span> <span class="ow">in</span> <span class="n">cnvbed</span><span class="p">[</span><span class="n">dataset</span><span class="p">]:</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">cnvbed</span><span class="p">[</span><span class="n">dataset</span><span class="p">][</span><span class="n">chrom</span><span class="p">]))</span> 
        <span class="n">cnvbed_df</span><span class="p">[</span><span class="n">dataset</span><span class="p">][</span><span class="s2">&quot;chrom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">chrom</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">))</span>
        <span class="n">cnvbed_df</span><span class="p">[</span><span class="n">dataset</span><span class="p">][</span><span class="s2">&quot;cnv_start&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">cnvbed_df</span><span class="p">[</span><span class="n">dataset</span><span class="p">][</span><span class="s2">&quot;cnv_end&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
    <span class="n">cnvbed_df</span><span class="p">[</span><span class="n">dataset</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">cnvbed_df</span><span class="p">[</span><span class="n">dataset</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span>
                                            <span class="n">subset</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;chrom&quot;</span><span class="p">,</span> <span class="s2">&quot;cnv_start&quot;</span><span class="p">,</span> <span class="s2">&quot;cnv_end&quot;</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">cnvbed_df</span><span class="p">[</span><span class="s2">&quot;delCases&quot;</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>      chrom   cnv_end  cnv_start
0     chr22  14819432   14482342
1     chr22  14773706   14602695
2     chr22  14773706   14628691
3     chr22  18686472   17107473
4     chr22  18683948   17237164
5     chr22  19787084   17237164
6     chr22  19921620   17237164
7     chr22  18686472   17250982
8     chr22  18772411   17250982
9     chr22  18684681   17259415
10    chr22  19787084   17259415
13    chr22  19921620   17259415
14    chr22  19787084   19030407
15    chr22  19790390   19041490
16    chr22  20169910   19867169
17    chr22  20141115   19919583
18    chr22  20158803   19919583
19    chr22  20169910   19919583
24    chr22  20241878   20140420
31    chr22  20259123   20140420
32    chr22  20241878   20140609
33    chr22  20765490   20639721
34    chr22  20793966   20639721
35    chr22  32497356   32395166
36    chr22  32604804   32496603
37    chr17    949597     119382
38    chr17   1411257    1180365
39    chr17   3504075    3393059
40    chr17   4059672    3890292
41    chr17   6198131    5541518
...     ...       ...        ...
1333  chr14  27094285   26986423
1335  chr14  41009478   37569543
1336  chr14  38673787   37939825
1337  chr14  41066682   40915706
1338  chr14  41069017   40915706
1340  chr14  41074958   40915706
1342  chr14  41074958   40917004
1343  chr14  42194930   41762699
1344  chr14  42154237   42042721
1345  chr14  42360600   42042721
1346  chr14  42154237   42042787
1347  chr14  43728537   42134475
1348  chr14  43234621   43132612
1349  chr14  45865527   45687634
1350  chr14  47930190   47812099
1351  chr14  47929708   47817280
1352  chr14  47930190   47817280
1353  chr14  47930470   47817280
1354  chr14  47974882   47858175
1356  chr14  47983250   47858175
1358  chr14  47974919   47858226
1360  chr14  47981452   47858226
1365  chr14  61927142   61784411
1366  chr14  62203805   61881530
1367  chr14  66470394   66287336
1368  chr14  79636319   79536021
1370  chr14  81939864   81693201
1371  chr14  82458569   82186231
1372  chr14  82613522   82436148
1373  chr14  84140365   83901679

[1161 rows x 3 columns]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[75]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># check if there are overlaps in 10K blocks genome</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">10000</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">-</span><span class="mi">9999</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="c1">#print (blocks)</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cnvbed_df</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="c1"># chrom same</span>
    <span class="n">value</span><span class="p">[</span><span class="s2">&quot;cnv_start&quot;</span><span class="p">]</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;cnv_start&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>14432528
14525461
14432528
14482342
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># check if there are overlaps in CNVs</span>
<span class="n">cnv_overlap</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cnvbed_df</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    </span>
<span class="s2">    FROM value</span>
<span class="s2">    WHERE chrom == chrom</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[153]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n1</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># to be obtained from literature</span>
<span class="n">n2</span> <span class="o">=</span> <span class="mi">80</span> <span class="c1"># to be obtained from literature</span>
<span class="n">p_del</span> <span class="o">=</span> <span class="mf">0.00006</span> <span class="c1"># to be obtained from real data</span>
<span class="n">p_dup</span> <span class="o">=</span> <span class="mf">0.00004</span> <span class="c1"># to be obtained from real data</span>
<span class="n">n_delcase</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">n_delctrl</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">n_dupcase</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">n_dupctrl</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">n_del</span> <span class="o">=</span> <span class="n">n_delcase</span><span class="o">+</span><span class="n">n_delctrl</span>
<span class="n">n_dup</span> <span class="o">=</span> <span class="n">n_dupcase</span><span class="o">+</span><span class="n">n_dupctrl</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># prevalence of the disease</span>
<span class="n">q</span> <span class="o">=</span> <span class="mf">0.002</span> <span class="c1"># q: Proportion of causal gene</span>
<span class="n">shape</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">delCNV</span><span class="p">(</span><span class="n">n1</span><span class="p">):</span>
    <span class="n">n_del</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
    <span class="n">len_delcnv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">geometric</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p_del</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_del</span><span class="p">)</span><span class="o">+</span><span class="mi">10000</span>
    <span class="k">return</span> <span class="n">len_delcnv</span>

<span class="k">def</span> <span class="nf">dupCNV</span><span class="p">(</span><span class="n">n2</span><span class="p">):</span>
    <span class="n">n_dup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>
    <span class="n">len_dupcnv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">geometric</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p_dup</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_dup</span><span class="p">)</span><span class="o">+</span><span class="mi">10000</span>
    <span class="k">return</span> <span class="n">len_dupcnv</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Step-3">Step 3<a class="anchor-link" href="#Step-3">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">genegroup</span><span class="p">(</span><span class="n">genelist</span><span class="p">):</span>
    <span class="n">cslgene</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">genelist</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">genelist</span><span class="p">)))</span>
    <span class="n">noncslgene</span> <span class="o">=</span> <span class="n">genelist</span> <span class="o">-</span> <span class="n">cslgene</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">cslgene</span><span class="p">,</span> <span class="n">noncslgene</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">p_case</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
    <span class="c1"># p1: Pr(case | CCNV), p0: Pr(case | NCNV)</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="n">rv</span><span class="o">-</span><span class="n">q</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">k</span><span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">rv</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">rv</span><span class="o">+</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">rv</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
    <span class="n">p_ccnv_case</span> <span class="o">=</span> <span class="n">p1</span><span class="o">*</span><span class="n">q</span> <span class="o">/</span> <span class="n">k</span>
    <span class="n">p_ncnv_case</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">p_ccnv_case</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p_ccnv_case</span><span class="p">,</span> <span class="n">p_ncnv_case</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">p_ctrl</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
    <span class="n">p_ccnv_ctrl</span> <span class="o">=</span> <span class="n">q</span>
    <span class="n">p_ncnv_ctrl</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">q</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p_ccnv_ctrl</span><span class="p">,</span> <span class="n">p_ncnv_ctrl</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Trial">Trial<a class="anchor-link" href="#Trial">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[79]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">cnvg</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="c1"># prevalence of the disease</span>
    <span class="n">q</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="c1"># q: Proportion of causal gene</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="n">r</span><span class="o">-</span><span class="n">q</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">k</span><span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">r</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">r</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">p1</span><span class="p">)</span>
    <span class="n">p_ccnv_case</span> <span class="o">=</span> <span class="n">p1</span><span class="o">*</span><span class="n">q</span><span class="o">/</span><span class="n">k</span>
    <span class="n">p_ncnv_case</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">p_ccnv_case</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p_ccnv_case</span><span class="p">,</span> <span class="n">p_ncnv_case</span><span class="p">)</span>
<span class="n">cnvg</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>4.889419045453884
0.043919588316617804
</pre>
</div>
</div>

<div class="output_area"><div class="prompt output_prompt">Out[79]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>(0.08783917663323561, 0.9121608233667644)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[152]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">CNVcase</span><span class="p">(</span><span class="n">delCNV</span><span class="p">):</span>
    <span class="n">cslcnv</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">CCNV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p_ccnv_case</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">CCNV</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">cslcnv</span><span class="o">.</span><span class="n">append</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
    </div>
  </div>
</body>
</html>
