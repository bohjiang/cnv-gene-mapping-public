#!/usr/bin/env sos-runner
#fileformat=SOS1.0

# This script releases notebooks and pipelines:
#
# 1. website to github.io

[convert_analysis]
input:  'analysis/*.ipynb', group_by=1
output: _input[0].replace('.ipynb', '.html').replace('analysis', 'docs')

run:
	jupyter nbconvert --to html --output ${_output!a} ${_input!a} --template toc2

[convert_pipeline]
input:  'analysis/*.sos', group_by=1
output: _input[0].replace('.sos', '.html').replace('analysis', 'docs')

run:
	sos convert ${_input} ${_output} --raw ${_input!b}

[publish]

# convert ipynb to HTML
sos_run('convert_analysis')
if len(glob.glob('analysis/*.sos')) > 0:
   sos_run('convert_pipeline')

# push subtree to gh-pages
run: workdir='.'
	git add --all docs/*
	git commit docs/* --no-verify -m 'Publish website'
	git push --no-verify

[default]
run:
	jt -t grade3 -T -N -f ptmono -nfs 12 -tfs 12 -tf droidsans -nf droidsans
	
sos_run('publish')

run:
	jt -r
