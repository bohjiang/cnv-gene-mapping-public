<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="ipynb_website:version" content="0.9.2" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" type="text/css" href="../css/jt.css">
<link rel="stylesheet" type="text/css" href="../css/toc2.css">
<link href="../site_libs/jqueryui-1.11.4/jquery-ui.css">
<link rel="stylesheet" href="../site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<link rel="stylesheet" href="../site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="../site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<link rel="stylesheet"
      href="../site_libs/highlight/textmate.css"
      type="text/css" />
<script src="../site_libs/highlight/highlight.js"></script>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>
<script src="../js/toc2.js"></script>
<script src="../js/docs.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"></script>
<script>
    MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
        },
        "HTML-CSS": {
            preferredFont: "TeX",
            availableFonts: ["TeX"],
            styles: {
                scale: 110,
                ".MathJax_Display": {
                    "font-size": "110%",
                }
            }
        }
    });
</script>
<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');
  // mark it active
  menuAnchor.parent().addClass('active');
  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>
<div class="container-fluid main-container">
<!-- tabsets -->
<script src="../site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>
<title>Gene Mapping with CNV</title>
<style type = "text/css">
body {
  font-family: "Droid Sans";
  padding-top: 66px;
  padding-bottom: 40px;
}
</style>
</head>
<body>
<div tabindex="-1" id="notebook" class="border-box-sizing">
<div class="container" id="notebook-container">
<!-- code folding -->
<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">Gene Mapping with CNV</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Overview</a>
</li>
<li>
  <a href="../analysis.html">Analysis</a>
</li>
<li>
  <a href="../setup.html">Setup</a>
</li>
<li>
  <a href="../writeup.html">Writeup</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
   <a href="http://github.com/gaow/cnv-gene-mapping"> <span class="fa fa-github"></span> </a>
</li>
</ul>
      </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Obtain-.feather-file-from-.pkl-to-analyze-in-R">Obtain .feather file from .pkl to analyze in R<a class="anchor-link" href="#Obtain-.feather-file-from-.pkl-to-analyze-in-R">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">feather</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">simulation</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="temporarily-changed-for-calcium-pathway">temporarily changed for calcium pathway<a class="anchor-link" href="#temporarily-changed-for-calcium-pathway">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># only for calcium pathway analysis</span>
<span class="kn">import</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">feather</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">Simulation_calcium</span> <span class="k">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">load_reference_gene</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">()</span>
<span class="n">ref</span> <span class="o">=</span> <span class="n">load_reference_gene</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;refgene_file&quot;</span><span class="p">])</span>
<span class="n">genes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="s1">&#39;gene_name&#39;</span><span class="p">])))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_feather</span><span class="p">(</span><span class="n">input_data</span><span class="p">):</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
    <span class="n">regression_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">genes</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;gene_name&quot;</span><span class="p">]),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span> 
                                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dat</span><span class="p">[</span><span class="s1">&#39;case&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dat</span><span class="p">[</span><span class="s1">&#39;ctrl&#39;</span><span class="p">]])</span>
    <span class="n">phenotype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;case&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;ctrl&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">regression_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">phenotype</span><span class="p">,</span> <span class="n">regression_data</span><span class="p">))</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">((</span><span class="n">regression_data</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">regression_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">phenotype</span><span class="p">,</span> <span class="n">regression_data</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">]))</span>
    <span class="n">output_data</span> <span class="o">=</span> <span class="n">feather</span><span class="o">.</span><span class="n">write_dataframe</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">regression_data</span><span class="p">,</span> 
                                          <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;phenotype&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">genes</span><span class="p">[</span><span class="n">mask</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span> 
                                          <span class="s2">&quot;data/calcium_pathway_N</span><span class="si">{}</span><span class="s2">.data.feather&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                          <span class="n">dat</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">][</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;n_case&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dat</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">][</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;n_ctrl&quot;</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">output_data</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_feather</span><span class="p">(</span><span class="s2">&quot;data/calcium_pathway_4000.data.pkl&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test4000</span> <span class="o">=</span> <span class="n">feather</span><span class="o">.</span><span class="n">read_dataframe</span><span class="p">(</span><span class="s2">&quot;data/calcium_pathway_N4000.data.feather&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">test4000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>      phenotype  MIR6069  FNBP4  ISCA2  LOC100506472  RPL39  LOC101927817  \
0           1.0      0.0    0.0    0.0           0.0    0.0           0.0   
1           1.0      0.0    0.0    0.0           0.0    0.0           0.0   
2           1.0      0.0    0.0    0.0           0.0    0.0           0.0   
3           1.0      0.0    0.0    0.0           0.0    0.0           0.0   
4           1.0      0.0    0.0    0.0           0.0    0.0           0.0   
5           1.0      0.0    0.0    0.0           0.0    0.0           0.0   
6           1.0      0.0    0.0    0.0           0.0    0.0           0.0   
7           1.0      0.0    0.0    0.0           0.0    0.0           0.0   
8           1.0      0.0    0.0    0.0           0.0    0.0           0.0   
9           1.0      0.0    0.0    0.0           0.0    0.0           0.0   
10          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
11          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
12          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
13          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
14          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
15          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
16          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
17          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
18          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
19          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
20          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
21          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
22          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
23          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
24          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
25          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
26          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
27          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
28          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
29          1.0      0.0    0.0    0.0           0.0    0.0           0.0   
...         ...      ...    ...    ...           ...    ...           ...   
3970        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3971        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3972        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3973        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3974        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3975        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3976        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3977        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3978        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3979        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3980        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3981        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3982        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3983        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3984        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3985        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3986        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3987        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3988        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3989        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3990        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3991        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3992        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3993        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3994        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3995        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3996        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3997        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3998        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
3999        0.0      0.0    0.0    0.0           0.0    0.0           0.0   
      TMEM231  TMEM72-AS1  SIRPG-AS1   ...     TTTY18  FBXW10  SLC10A3  PIN4  \
0         0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
1         0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
2         0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3         0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
4         0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
5         0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
6         0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
7         0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
8         0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
9         0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
10        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
11        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
12        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
13        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
14        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
15        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
16        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
17        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
18        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
19        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
20        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
21        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
22        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
23        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
24        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
25        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
26        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
27        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
28        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
29        0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
...       ...         ...        ...   ...        ...     ...      ...   ...   
3970      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3971      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3972      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3973      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3974      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3975      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3976      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3977      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3978      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3979      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3980      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3981      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3982      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3983      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3984      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3985      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3986      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3987      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3988      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3989      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3990      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3991      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3992      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3993      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3994      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3995      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3996      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3997      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3998      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
3999      0.0         0.0        0.0   ...        0.0     0.0      0.0   0.0   
      MIR4769  LOC102723544  FAAHP1  HCG26  MIR532  MIR6807  
0         0.0           0.0     0.0    0.0     0.0      0.0  
1         0.0           0.0     0.0    0.0     0.0      0.0  
2         0.0           0.0     0.0    0.0     0.0      0.0  
3         0.0           0.0     0.0    0.0     0.0      0.0  
4         0.0           0.0     0.0    0.0     0.0      0.0  
5         0.0           0.0     0.0    0.0     0.0      0.0  
6         0.0           0.0     0.0    0.0     0.0      0.0  
7         0.0           0.0     0.0    0.0     0.0      0.0  
8         0.0           0.0     0.0    0.0     0.0      0.0  
9         0.0           0.0     0.0    0.0     0.0      0.0  
10        0.0           0.0     0.0    0.0     0.0      0.0  
11        0.0           0.0     0.0    0.0     0.0      0.0  
12        0.0           0.0     0.0    0.0     0.0      0.0  
13        0.0           0.0     0.0    0.0     0.0      0.0  
14        0.0           0.0     0.0    0.0     0.0      0.0  
15        0.0           0.0     0.0    0.0     0.0      0.0  
16        0.0           0.0     0.0    0.0     0.0      0.0  
17        0.0           0.0     0.0    0.0     0.0      0.0  
18        0.0           0.0     0.0    0.0     0.0      0.0  
19        0.0           0.0     0.0    0.0     0.0      0.0  
20        0.0           0.0     0.0    0.0     0.0      0.0  
21        0.0           0.0     0.0    0.0     0.0      0.0  
22        0.0           0.0     0.0    0.0     0.0      0.0  
23        0.0           0.0     0.0    0.0     0.0      0.0  
24        0.0           0.0     0.0    0.0     0.0      0.0  
25        0.0           0.0     0.0    0.0     0.0      0.0  
26        0.0           0.0     0.0    0.0     0.0      0.0  
27        0.0           0.0     0.0    0.0     0.0      0.0  
28        0.0           0.0     0.0    0.0     0.0      0.0  
29        0.0           0.0     0.0    0.0     0.0      0.0  
...       ...           ...     ...    ...     ...      ...  
3970      0.0           0.0     0.0    0.0     0.0      0.0  
3971      0.0           0.0     0.0    0.0     0.0      0.0  
3972      0.0           0.0     0.0    0.0     0.0      0.0  
3973      0.0           0.0     0.0    0.0     0.0      0.0  
3974      0.0           0.0     0.0    0.0     0.0      0.0  
3975      0.0           0.0     0.0    0.0     0.0      0.0  
3976      0.0           0.0     0.0    0.0     0.0      0.0  
3977      0.0           0.0     0.0    0.0     0.0      0.0  
3978      0.0           0.0     0.0    0.0     0.0      0.0  
3979      0.0           0.0     0.0    0.0     0.0      0.0  
3980      0.0           0.0     0.0    0.0     0.0      0.0  
3981      0.0           0.0     0.0    0.0     0.0      0.0  
3982      0.0           0.0     0.0    0.0     0.0      0.0  
3983      0.0           0.0     0.0    0.0     0.0      0.0  
3984      0.0           0.0     0.0    0.0     0.0      0.0  
3985      0.0           0.0     0.0    0.0     0.0      0.0  
3986      0.0           0.0     0.0    0.0     0.0      0.0  
3987      0.0           0.0     0.0    0.0     0.0      0.0  
3988      0.0           0.0     0.0    0.0     0.0      0.0  
3989      0.0           0.0     0.0    0.0     0.0      0.0  
3990      0.0           0.0     0.0    0.0     0.0      0.0  
3991      0.0           0.0     0.0    0.0     0.0      0.0  
3992      0.0           0.0     0.0    0.0     0.0      0.0  
3993      0.0           0.0     0.0    0.0     0.0      0.0  
3994      0.0           0.0     0.0    0.0     0.0      0.0  
3995      0.0           0.0     0.0    0.0     0.0      0.0  
3996      0.0           0.0     0.0    0.0     0.0      0.0  
3997      0.0           0.0     0.0    0.0     0.0      0.0  
3998      0.0           0.0     0.0    0.0     0.0      0.0  
3999      0.0           0.0     0.0    0.0     0.0      0.0  
[4000 rows x 4917 columns]
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ref</span> <span class="o">=</span> <span class="n">load_reference_gene</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;refgene_file&quot;</span><span class="p">])</span>
<span class="n">genes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="s1">&#39;gene_name&#39;</span><span class="p">])))</span>
<span class="k">def</span> <span class="nf">get_feather</span><span class="p">(</span><span class="n">input_data</span><span class="p">):</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
    <span class="n">regression_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">genes</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;gene_name&quot;</span><span class="p">]),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span> 
                                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dat</span><span class="p">[</span><span class="s1">&#39;case&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dat</span><span class="p">[</span><span class="s1">&#39;ctrl&#39;</span><span class="p">]])</span>
    <span class="n">phenotype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;case&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;ctrl&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">regression_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">phenotype</span><span class="p">,</span> <span class="n">regression_data</span><span class="p">))</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">((</span><span class="n">regression_data</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">regression_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">phenotype</span><span class="p">,</span> <span class="n">regression_data</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">]))</span>
    <span class="n">output_data</span> <span class="o">=</span> <span class="n">feather</span><span class="o">.</span><span class="n">write_dataframe</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">regression_data</span><span class="p">,</span> 
                                          <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;phenotype&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">genes</span><span class="p">[</span><span class="n">mask</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span> 
                                          <span class="s2">&quot;data/del_sim_shape</span><span class="si">{}</span><span class="s2">_scale1_p</span><span class="si">{}</span><span class="s2">_N</span><span class="si">{}</span><span class="s2">_M</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">.data.feather&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                          <span class="n">dat</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">][</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;odds_ratio_params&quot;</span><span class="p">][</span><span class="s2">&quot;shape&quot;</span><span class="p">],</span> 
                                          <span class="n">dat</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">][</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;prevalence&quot;</span><span class="p">],</span> 
                                          <span class="n">dat</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">][</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;n_case&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dat</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">][</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;n_ctrl&quot;</span><span class="p">],</span> 
                                          <span class="n">dat</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">][</span><span class="s2">&quot;args&quot;</span><span class="p">][</span><span class="s2">&quot;n_causal_gene&quot;</span><span class="p">],</span> <span class="n">dat</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">][</span><span class="s2">&quot;seed&quot;</span><span class="p">]))</span>
<span class="c1">#     the last item -seed - need to be fixed. For new simulation after 04/25/17, use the default one. </span>
<span class="c1">#     For previous simulations, use seed manually.</span>
    <span class="k">return</span> <span class="n">output_data</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_feather</span><span class="p">(</span><span class="s2">&quot;data/del_sim_shape9_scale1_p0.01_N4000_M200_12.data.pkl&quot;</span><span class="p">)</span>
<span class="n">get_feather</span><span class="p">(</span><span class="s2">&quot;data/del_sim_shape9_scale1_p0.01_N4000_M100_12.data.pkl&quot;</span><span class="p">)</span>
<span class="n">get_feather</span><span class="p">(</span><span class="s2">&quot;data/del_sim_shape5_scale1_p0.01_N4000_M200_12.data.pkl&quot;</span><span class="p">)</span>
<span class="n">get_feather</span><span class="p">(</span><span class="s2">&quot;data/del_sim_shape5_scale1_p0.01_N4000_M100_12.data.pkl&quot;</span><span class="p">)</span>
<span class="n">get_feather</span><span class="p">(</span><span class="s2">&quot;data/del_sim_shape3_scale1_p0.01_N4000_M200_12.data.pkl&quot;</span><span class="p">)</span>
<span class="n">get_feather</span><span class="p">(</span><span class="s2">&quot;data/del_sim_shape3_scale1_p0.01_N4000_M100_12.data.pkl&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_feather</span><span class="p">(</span><span class="s2">&quot;data/del_sim_scale9_shape1_N4000_M200_999.data.pkl&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dat</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;data/del_sample_test_4000.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<span class="n">ref</span> <span class="o">=</span> <span class="n">load_reference_gene</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;refgene_file&quot;</span><span class="p">])</span>
<span class="n">genes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="s1">&#39;gene_name&#39;</span><span class="p">])))</span>
<span class="n">regression_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">genes</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;gene_name&quot;</span><span class="p">]),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span> 
                            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dat</span><span class="p">[</span><span class="s1">&#39;case&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dat</span><span class="p">[</span><span class="s1">&#39;ctrl&#39;</span><span class="p">]])</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">regression_data</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000, 26929)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">regression_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;case&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;ctrl&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">regression_data</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">regression_data</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000, 26930)
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">((</span><span class="n">regression_data</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="o">==</span><span class="kc">True</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="o">==</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>26930
26930
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">regression_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;case&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;ctrl&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">regression_data</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">]))</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">regression_data</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">regression_data</span><span class="p">)</span>
<span class="n">pprint</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>(4000, 4941)
4000
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">feather</span><span class="o">.</span><span class="n">write_dataframe</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">regression_data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;phenotype&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">genes</span><span class="p">[</span><span class="n">mask</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span> 
                        <span class="s2">&quot;data/del_test_data.feather&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
<hr>
&copy 2016-2017 Min Qiao at <a href="http://xinhelab.org">Xin He lab</a>, the University of Chicago
<p><small>Exported from <a href="http://github.com/gaow/cnv-gene-mapping/blob/c21a7c3ff5aaf56831ebd67b6e2d282b8f1f7620/analysis/20170425_feather.ipynb"><code>analysis/20170425_feather.ipynb</code></a> committed by Min Qiao on Thu Aug 10 19:50:16 2017 <a href="http://github.com/gaow/cnv-gene-mapping/commit/c21a7c3ff5aaf56831ebd67b6e2d282b8f1f7620">revision 267, c21a7c3</a> <a href="https://stephenslab.github.io/ipynb-website/notes.html#Note-about-commit-ids"><span class="fa fa-question-circle"></span></a></small></p>
</div>
</div>
</body>
</html>
